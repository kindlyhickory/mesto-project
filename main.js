(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup_edit"),n=document.querySelector(".profile__edit-button"),r=t.querySelector(".popup__data"),o=t.querySelector(".popup__name"),c=t.querySelector(".popup__famed"),a=document.querySelector(".profile__add-button"),u=document.querySelector(".popup_add"),i=u.querySelector(".popup__data"),l=u.querySelector(".popup__place-title"),s=u.querySelector(".popup__image-link"),d=document.querySelector(".popup_image"),p=d.querySelector(".popup__image"),f=d.querySelector(".popup__image-title"),_=document.querySelector(".profile__image"),v=document.querySelector(".profile__name"),m=document.querySelector(".profile__description"),y="popup__save_type_inactive",h=Array.from(u.querySelectorAll("".concat(".popup__item"))),b=u.querySelector("".concat(".popup__save")),S=document.querySelector(".profile__image-container"),g=document.querySelector(".popup_avatar-change"),q=g.querySelector(".popup__data"),L=g.querySelector(".popup__avatar"),k=g.querySelector(".popup__save");function E(e){"Escape"===e.key&&C(document.querySelector(".popup_opened"))}function A(e){document.addEventListener("keydown",E),e.classList.add("popup_opened")}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",E)}var x={baseUrl:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"c89b1818-4cda-41d9-880f-b53f0e3aae65","Content-type":"application/json"}};function U(e){return e.ok?e.json():Promise.reject("Ошибка запроса: ".concat(e.status,". Запрос: ").concat(e.url))}var w,D=document.querySelector(".card-template").content,O=document.querySelector(".cards");function T(e,t){e.textContent=t}function j(e,t,n,r,o,c,a){var u=D.querySelector(".cards__item").cloneNode("true"),i=u.querySelector(".cards__image"),l=u.querySelector(".cards__title"),s=u.querySelector(".cards__like-counter"),_=u.querySelector(".cards__like-button"),v=u.querySelector(".cards__delete-button");return o.forEach((function(e){a===e._id&&_.classList.add("cards__like-button_activated")})),c!==a?v.remove():v.addEventListener("click",(function(){var e;(e=r,fetch("".concat(x.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:x.headers}).then(U)).then((function(){return u.remove()})).catch((function(e){return console.log(e)}))})),s.textContent=n,_.addEventListener("click",(function(e){return function(e,t,n){e.target.classList.contains("cards__like-button_activated")?function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:x.headers}).then(U)}(t).then((function(t){e.target.classList.toggle("cards__like-button_activated"),T(n,t.likes.length)})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(x.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:x.headers}).then(U)}(t).then((function(t){e.target.classList.toggle("cards__like-button_activated"),T(n,t.likes.length)})).catch((function(e){return console.log(e)}))}(e,r,s)})),u.querySelector(".cards__image").addEventListener("click",(function(){!function(e,t){p.setAttribute("src",e),p.setAttribute("alt",t),f.textContent=t}(i.src,l.textContent),A(d)})),i.setAttribute("src",t),i.setAttribute("alt",e),l.textContent=e,u}function P(e,t){e.prepend(t)}function I(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("".concat(n)),t.removeAttribute("disabled")):(t.classList.add("".concat(n)),t.setAttribute("disabled",""))}function B(e,t,n,r,o,c){r.textContent=e,o.textContent=t,N(c,n,e)}function N(e,t,n){e.setAttribute("src",t),e.setAttribute("alt",n)}function J(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранить",o=e.target.querySelector(".popup__save");o.textContent=t?"Сохранение...":r}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&C(e),t.target.classList.contains("popup__close-button")&&C(e)}))})),n.addEventListener("click",(function(){o.setAttribute("value",v.textContent),c.setAttribute("value",m.textContent),A(t)})),a.addEventListener("click",(function(){A(u),I(h,b,y)})),r.addEventListener("submit",(function(e){J(e,!0,t),function(e){var n,r;e.preventDefault(),(n=o.value,r=c.value,fetch("".concat(x.baseUrl,"/users/me"),{method:"PATCH",headers:x.headers,body:JSON.stringify({name:n,about:r})}).then(U)).then((function(e){B(e.name,e.about,e.avatar,v,m,_),C(t)})).catch((function(e){return console.log(e)})).finally((function(){J(e,!1,t,"Сохранить")}))}(e)})),i.addEventListener("submit",(function(e){J(e,!0,u),function(e){var t,n;e.preventDefault(),(t=l.value,n=s.value,fetch("".concat(x.baseUrl,"/cards"),{method:"POST",headers:x.headers,body:JSON.stringify({name:t,link:n})}).then(U)).then((function(t){P(O,j(t.name,t.link,t.likes.length,t._id,t.likes,t.owner._id,w)),C(u),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){J(e,!1,u,"Создать")}))}(e)})),q.addEventListener("submit",(function(e){J(e,!0,g),function(e){var t;e.preventDefault(),(t=L.value,fetch("".concat(x.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:x.headers,body:JSON.stringify({avatar:t})}).then(U)).then((function(t){N(_,t.avatar,t.name),C(g),e.target.reset()})).catch((function(e){return console.log(e)})).finally((function(){J(e,!1,g,"Сохранить")}))}(e)})),S.addEventListener("click",(function(){A(g),I([L],k,y)})),document.addEventListener("DOMContentLoaded",(function(){Promise.all([fetch("".concat(x.baseUrl,"/users/me"),{headers:x.headers}).then(U),fetch("".concat(x.baseUrl,"/cards"),{headers:x.headers}).then(U)]).then((function(e){var t,n,r=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,c=[],a=!0,u=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(c.push(r.value),!t||c.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==n.return||n.return()}finally{if(u)throw o}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],c=r[1];w=o._id,B(o.name,o.about,o.avatar,v,m,_,o._id),c.forEach((function(e){P(O,j(e.name,e.link,e.likes.length,e._id,e.likes,e.owner._id,w))}))})).catch((function(e){return console.log(e)}))})),function(e){var t=e.formSelector,n=e.inputSelector,r=e.submitButtonSelector,o=e.disabledButtonClass,c=e.inputInvalidClass,a=e.errorActiveClass,u=e.errorClass;Array.from(document.querySelectorAll("".concat(t))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,r,o,c,a){var u=Array.from(e.querySelectorAll("".concat(t))),i=e.querySelector("".concat(n));I(u,i,r),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,r,o){t.validity.valid?function(e,t,n,r,o){var c=e.querySelector(".".concat(r,"_").concat(t.id));t.classList.remove("".concat(o)),c.classList.remove("".concat(n)),c.textContent=""}(e,t,n,r,o):function(e,t,n,r,o,c){var a=e.querySelector(".".concat(o,"_").concat(t.id));t.classList.add("".concat(c)),a.textContent=n,a.classList.add("".concat(r))}(e,t,t.validationMessage,n,r,o)}(e,t,c,a,o),I(u,i,r)}))}))}(e,n,r,o,c,a,u)}))}({formSelector:".popup__data",inputSelector:".popup__item",submitButtonSelector:".popup__save",disabledButtonClass:"popup__save_type_inactive",inputInvalidClass:".popup__item_type_active",errorActiveClass:".form__input-error_active",errorClass:"popup__input-error"})})();