(()=>{"use strict";var e=document.querySelector(".popup_edit"),t=document.querySelector(".profile__edit-button"),n=e.querySelector(".popup__data"),o=e.querySelector(".popup__name"),c=e.querySelector(".popup__famed"),r=document.querySelector(".profile__add-button"),a=document.querySelector(".popup_add"),u=a.querySelector(".popup__data"),i=a.querySelector(".popup__place-title"),s=a.querySelector(".popup__image-link"),l=document.querySelector(".popup_image"),d=l.querySelector(".popup__image"),p=l.querySelector(".popup__image-title"),f=document.querySelector(".profile__image"),_=document.querySelector(".profile__name"),m=document.querySelector(".profile__description"),v=document.querySelector(".profile__image-container"),h=document.querySelector(".popup_avatar-change"),y=h.querySelector(".popup__data"),S=h.querySelector(".popup__avatar");function b(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.classList.remove("".concat(n)):t.classList.add("".concat(n))}function q(e){"Escape"===e.key&&L(document.querySelector(".popup_opened"))}function k(e){var t=document.querySelector(".popup_opened");e.target===t&&L(t)}function g(e){e.classList.contains("popup_add")&&b(Array.from(e.querySelectorAll("".concat(".popup__item"))),e.querySelector("".concat(".popup__save")),"popup__save_type_inactive"),e.querySelector(".popup__close-button").addEventListener("click",(function(){return L(e)})),document.addEventListener("keydown",q),e.classList.add("popup_opened"),setTimeout((function(){return document.addEventListener("click",k)}),1)}function L(e){e.querySelector(".popup__close-button").removeEventListener("click",(function(){return L(e)})),e.classList.remove("popup_opened"),document.removeEventListener("keydown",q),document.removeEventListener("click",k)}var E={baseUrl:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"c89b1818-4cda-41d9-880f-b53f0e3aae65","Content-type":"application/json"}};function C(){return fetch("".concat(E.baseUrl,"/users/me"),{headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения личных данных: ".concat(e.status))}))}var A,j,x,P,U,D,T,O,w=document.querySelector(".card-template").content,B=document.querySelector(".cards");function N(e,t){e.textContent=t}function J(e,t,n,o,c,r,a){var u=w.querySelector(".cards__item").cloneNode("true"),i=u.querySelector(".cards__image"),s=u.querySelector(".cards__title"),f=u.querySelector(".cards__like-counter"),_=u.querySelector(".cards__like-button"),m=u.querySelector(".cards__delete-button");return c.forEach((function(e){a===e._id&&_.classList.add("cards__like-button_activated")})),r!==a?m.remove():m.addEventListener("click",(function(){var e;(e=o,fetch("".concat(E.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления лайка: ".concat(e.status))}))).then(u.remove()).catch((function(e){return console.log(e)}))})),f.textContent=n,_.addEventListener("click",(function(e){return function(e,t,n){e.target.classList.toggle("cards__like-button_activated"),e.target.classList.contains("cards__like-button_activated")?function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка постановки лайка: ".concat(e.status))}))}(t).then((function(e){N(n,e.likes.length)})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(E.baseUrl,"/cards/likes/").concat(e),{method:"DELETE",headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка удаления лайка: ".concat(e.status))}))}(t).then((function(e){N(n,e.likes.length)})).catch((function(e){return console.log(e)}))}(e,o,f)})),u.querySelector(".cards__image").addEventListener("click",(function(){!function(e,t){d.setAttribute("src",e),d.setAttribute("alt",t),p.textContent=t}(i.src,s.textContent),g(l)})),i.setAttribute("src",t),i.setAttribute("alt",e),s.textContent=e,u}function H(e,t){e.prepend(t)}function I(e,t,n,o,c,r){o.textContent=e,c.textContent=t,M(r,n,e)}function M(e,t,n){e.setAttribute("src",t),e.setAttribute("alt",n)}function z(e,t,n){var o=e.target.querySelector(".popup__save");t?o.textContent="Сохранение":n.classList.contains("popup_avatar-change")||n.classList.contains("popup_edit")?o.textContent="Сохранить":n.classList.contains("popup_add")&&(o.textContent="Создать")}t.addEventListener("click",(function(){o.setAttribute("value",_.textContent),c.setAttribute("value",m.textContent),g(e)})),r.addEventListener("click",(function(){return g(a)})),n.addEventListener("submit",(function(t){z(t,!0,e),function(t){var n,r;t.preventDefault(),(n=o.value,r=c.value,fetch("".concat(E.baseUrl,"/users/me"),{method:"PATCH",headers:E.headers,body:JSON.stringify({name:n,about:r})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка изменения данных пользователя: ".concat(e.status))}))).then((function(e){I(e.name,e.about,e.avatar,_,m,f)})).catch((function(e){return console.log(e)})).finally((function(){z(t,!1,e)})),L(e)}(t)})),u.addEventListener("submit",(function(e){z(e,!0,a),function(e){var t,n;e.preventDefault(),(t=i.value,n=s.value,fetch("".concat(E.baseUrl,"/cards"),{method:"POST",headers:E.headers,body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка отправки карточки на сервер: ".concat(e.status))}))).then((function(e){C().then((function(t){H(B,J(e.name,e.link,e.likes.length,e._id,e.likes,e.owner._id,t._id))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})).finally((function(){z(e,!1,a)})),e.target.reset(),L(a)}(e)})),y.addEventListener("submit",(function(e){z(e,!0,h),function(e){e.preventDefault(),C().then((function(e){var t;(t=S.value,fetch("".concat(E.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:E.headers,body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка изменения аватара пользователя: ".concat(e.status))}))).then((function(e){M(f,e.avatar,e.name)})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)})).finally((function(){z(e,!1,h)})),L(h)}(e)})),v.addEventListener("click",(function(){return g(h)})),document.addEventListener("DOMContentLoaded",(function(){return C().then((function(e){I(e.name,e.about,e.avatar,_,m,f,e._id)})).catch((function(e){return console.log(e)})),void C().then((function(e){fetch("".concat(E.baseUrl,"/cards"),{headers:E.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка получения карточек с сервера: ".concat(e.status))})).then((function(t){t.forEach((function(t){H(B,J(t.name,t.link,t.likes.length,t._id,t.likes,t.owner._id,e._id))}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))})),j=(A={formSelector:".popup__data",inputSelector:".popup__item",submitButtonSelector:".popup__save",disabledButtonClass:"popup__save_type_inactive",inputInvalidClass:".popup__item_type_active",errorActiveClass:".form__input-error_active",errorClass:"popup__input-error"}).formSelector,x=A.inputSelector,P=A.submitButtonSelector,U=A.disabledButtonClass,D=A.inputInvalidClass,T=A.errorActiveClass,O=A.errorClass,Array.from(document.querySelectorAll("".concat(j))).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t,n,o,c,r,a){var u=Array.from(e.querySelectorAll("".concat(t))),i=e.querySelector("".concat(n));b(u,i,o),u.forEach((function(t){t.addEventListener("input",(function(){!function(e,t,n,o,c){t.validity.valid?function(e,t,n,o,c){var r=e.querySelector(".".concat(o,"_").concat(t.id));t.classList.remove("".concat(c)),r.classList.remove("".concat(n)),r.textContent=""}(e,t,n,o,c):function(e,t,n,o,c,r){var a=e.querySelector(".".concat(c,"_").concat(t.id));t.classList.add("".concat(r)),a.textContent=n,a.classList.add("".concat(o))}(e,t,t.validationMessage,n,o,c)}(e,t,r,a,c),b(u,i,o)}))}))}(e,x,P,U,D,T,O)}))})();